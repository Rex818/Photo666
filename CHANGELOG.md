# Photo666 更新日志

## [0.3.0] - 2025-08-16

### 🆕 新增功能
- **JoyCaption插件诊断信息窗口**: 完善的插件状态诊断和问题排查功能
  - 显示插件状态、组件状态、配置状态、模型状态、系统信息
  - 提供使用建议，帮助用户排查JC快速处理功能的问题
  - 支持实时刷新诊断信息，无需重新打开窗口
- **统一的标签管理系统**: 实现 `unified_tags` JSON字段，解决11个冗余标签字段问题
  - 智能双写策略确保向后兼容
  - 支持Florence2等插件正常工作
  - 支持长文本标签（每字段最大2048字节）

### 🔧 技术改进
- **数据库批量操作优化**: 大目录导入速度提升3-5倍
  - 实现 `find_existing_hashes` 批量查询方法
  - 实现 `batch_insert_photos` 批量插入方法
  - 实现 `batch_add_photos_to_album` 批量关联方法
- **相册显示性能优化**: 异步缩略图加载，初始加载速度提升5-8倍
  - 实现异步缩略图加载 (QThreadPool + QRunnable)
  - 实现虚拟化显示 (分页 + 按需加载)
  - 实现无限滚动加载
- **滚动性能优化**: 滚动事件节流、缩略图缓存、可见性检测
  - 滚动事件节流 (100ms节流)
  - 缩略图项缓存机制 (最大20个缓存项)
  - 智能虚拟化管理 (最大150个可见项)
- **搜索功能增强**: 支持单词、词组、句子、引号精确匹配
  - 统一标签系统集成，搜索更准确
  - 支持逗号、分号分隔多个关键词
  - 支持引号包围的精确词组匹配

### 🐛 问题修复
- **修复JoyCaption插件诊断信息窗口问题**
  - 修复刷新按钮每次点击都创建新窗口的问题
  - 修复关闭按钮报错的问题
  - 重构代码，提取格式化方法，避免代码重复
- **修复数据库字段不一致问题**
  - 实现 `UnifiedTagsAccessor` 兼容性层
  - 支持原有11个标签字段和新的 `unified_tags` 字段
  - 确保所有插件正常工作
- **修复AI信息显示和标签翻译问题**
  - 修复标签翻译保存失败的问题
  - 修复AI信息显示不完整的问题
  - 优化标签编辑和保存流程

### 📋 兼容性
- 完全兼容原有的所有插件和功能
- 保持现有数据库结构，通过兼容性层支持旧版本
- 支持长文本标签（每字段最大2048字节）

### 🔒 安全性
- 改进错误处理机制，防止程序崩溃
- 增强输入验证，防止恶意输入
- 优化内存使用，防止内存泄漏

---

## [0.2.0] - 2025-08-03

### 🆕 新增功能
- AI图片信息识别功能
- 多语言标签支持
- 插件系统架构
- 基础图片管理功能

### 🔧 技术特性
- PyQt6图形界面
- SQLite数据库存储
- 模块化插件架构
- 多线程处理支持

### 🐛 问题修复
- 修复基础功能问题
- 改进用户界面响应性
